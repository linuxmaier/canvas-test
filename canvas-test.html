<!DOCTYPE html>
<html>
<head>
<title>Canvas Testing Ground</title>
</head>
<body>
<h1 id="head1">!!WARNING - CANVAS TESTING GROUND!!</h1>
<p id="preface">This is my canvas testing ground.</p>
<canvas id="testingGround" width=1000 height=750 style="border:1px solid #000000;">Canvas didn't render.</canvas>
<script>
(function() {
  var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
  window.requestAnimationFrame = requestAnimationFrame;
})();

function drawRect (myRect, ctext) {
	ctext.beginPath();
	ctext.rect(myRect.x, myRect.y, myRect.width, myRect.height);
	ctext.fillStyle = myRect.fillStyling;
	ctext.fill();
	ctext.lineWidth = myRect.borderWidth;
	ctext.strokeStyle = "black";
	ctext.stroke();
}

function animate(myRect, tground, ctext, startTime) {
	var time = ((new Date()).getTime() - startTime) / 1000;
	var linearSpeed = 0;
	var acceleration = 4;
	var friction = .8;
	
	//handles x
	if ((keys[37] || keys[39]) && !(keys[37] && keys[39])) {
		myRect.xVelocity += applyAccel(acceleration, time);
		if (myRect.xVelocity > 10) { myRect.xVelocity = 10; }
		if (myRect.xVelocity < -10) { myRect.xVelocity = -10; }
	}
	else {
		if (myRect.xVelocity > 1 || myRect.xVelocity < -1) {
			myRect.xVelocity *= friction;
		}
		else { myRect.xVelocity = 0; }
	}

	//handles y
	if ((keys[38] || keys[40]) && !(keys[38] && keys[40])) {
		myRect.yVelocity += applyAccel(acceleration, time);
		if (myRect.yVelocity > 10) { myRect.yVelocity = 10; }
		if (myRect.yVelocity < -10) { myRect.yVelocity = -10; }
	}
	else {
		if (myRect.yVelocity > .1 || myRect.yVelocity < -.1) {
			myRect.yVelocity *= friction;
		}
		else { myRect.yVelocity = 0; }
	}

	if (!(keys[37] || keys[38] || keys[39] || keys[40] ) && (myRect.xVelocity == 0 && myRect.yVelocity == 0)) { 
		startTime = (new Date()).getTime();
		time = 0;
	}

	myRect.x += myRect.xVelocity * time;
	myRect.y += myRect.yVelocity * time;
	ctext.clearRect(0, 0, tground.width, tground.height);
	drawRect(myRect, ctext);
	requestAnimationFrame(function() {animate(myRect, tground, ctext, startTime)});
}

function applyAccel (acceleration, time) {
	var newVel = 0;

	if (keys[37] || keys[38]) {
		newVel = acceleration * time * -1;
	}

	if (keys[39] || keys[40]) {
		newVel = acceleration * time;
	}

	return newVel;	
}

var tground = document.getElementById("testingGround");
var ctext = tground.getContext("2d");

var myRect = {
x: 0,
y: 75,
width: 100,
height: 50,
borderWidth: 1,
fillStyling: "#00FF00",
xVelocity: 0,
yVelocity: 0
};

var keys = [];
var startTime = (new Date()).getTime();

document.body.addEventListener("keydown", function (e) {keys[e.keyCode] = true;});

document.body.addEventListener("keyup", function (e) {keys[e.keyCode] = false;});

drawRect(myRect, ctext);

animate(myRect, tground, ctext, startTime);

</script>
</body>
</html>
